From: Markus Koschany <apo@debian.org>
Date: Wed, 28 Sep 2022 20:53:24 +0200
Subject: CVE-2022-27337

Bug-Debian: https://bugs.debian.org/1010695
Origin: https://gitlab.freedesktop.org/poppler/poppler/-/commit/81044c64b9ed9a10ae82a28bac753060bdfdac74
---
 poppler/Hints.cc | 20 ++++++++++++++++----
 1 file changed, 16 insertions(+), 4 deletions(-)

diff --git a/poppler/Hints.cc b/poppler/Hints.cc
index bdd0d32..679179e 100644
--- a/poppler/Hints.cc
+++ b/poppler/Hints.cc
@@ -117,15 +117,27 @@ void Hints::readTables(BaseStream *str, Linearization *linearization, XRef *xref
   obj.initNull();
   Stream *s = str->makeSubStream(hintsOffset, gFalse, hintsLength, &obj);
   s->reset();
-  for (Guint i=0; i < hintsLength; i++) { *p++ = s->getChar(); }
-  delete s;
+  for (Guint i=0; i < hintsLength; i++) {
+            const int c = s->getChar();
+            if (unlikely(c == EOF)) {
+                error(errSyntaxWarning, -1, "Found EOF while reading hints");
+                return;
+            }
+            *p++ = c;
+  }
 
   if (hintsOffset2 && hintsLength2) {
     obj.initNull();
     s = str->makeSubStream(hintsOffset2, gFalse, hintsLength2, &obj);
     s->reset();
-    for (Guint i=0; i < hintsLength2; i++) { *p++ = s->getChar(); }
-    delete s;
+    for (Guint i=0; i < hintsLength2; i++) {
+            const int c = s->getChar();
+            if (unlikely(c == EOF)) {
+                error(errSyntaxWarning, -1, "Found EOF while reading hints2");
+                return;
+            }
+            *p++ = c;
+    }
   }
 
   obj.initNull();
