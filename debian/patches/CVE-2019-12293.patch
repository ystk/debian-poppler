From 89a5367d49b2556a2635dbb6d48d6a6b182a2c6c Mon Sep 17 00:00:00 2001
From: Albert Astals Cid <aacid@kde.org>
Date: Thu, 23 May 2019 00:54:29 +0200
Subject: [PATCH] JPEG2000Stream: fail gracefully if not all components have
 the same WxH

I think this is just a mistake, or at least the only file we have with
this scenario is a fuzzed one
---
 poppler/JPEG2000Stream.cc | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

--- a/poppler/JPEG2000Stream.cc
+++ b/poppler/JPEG2000Stream.cc
@@ -89,6 +89,12 @@
         close();
         break;
       }
+      const int componentPixels = image->comps[component].w * image->comps[component].h;
+      if (componentPixels != npixels) {
+        error(errSyntaxWarning, -1, "Component {0:d} has different WxH than component 0", component);
+        close();
+        break;
+      }
       unsigned char *cdata = (unsigned char *)image->comps[component].data;
       int adjust = 0;
       if (image->comps[component].prec > 8)
