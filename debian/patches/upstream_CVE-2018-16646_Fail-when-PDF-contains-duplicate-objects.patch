From 9ea471459f37b4595f3032e64d2c6a659c050529 Mon Sep 17 00:00:00 2001
From: Marek Kasik <mkasik@redhat.com>
Date: Wed, 26 Sep 2018 16:13:06 +0200
Subject: [PATCH 1/2] Fail when PDF contains duplicate objects

Check whether current xrefEntry is already occupied during XRef::constructXRef().
If yes then check its offset against current position and fail if they
are different.
This helps with files which reach recursionLimit in Parser.cc.
---
 poppler/XRef.cc | 7 +++++++
 1 file changed, 7 insertions(+)

--- a/poppler/XRef.cc
+++ b/poppler/XRef.cc
@@ -1008,6 +1008,13 @@
 		      return gFalse;
 		    }
 		  }
+		  if (entries[num].type != xrefEntryFree &&
+		      gen == entries[num].gen &&
+		      entries[num].offset != pos - start &&
+		      entries[num].offset != -1) {
+		    error(errSyntaxError, -1, "Duplicate object reference {0:d} {1:d}", num, gen);
+		    return gFalse;
+		  }
 		  if (entries[num].type == xrefEntryFree ||
 		      gen >= entries[num].gen) {
 		    entries[num].offset = pos - start;
