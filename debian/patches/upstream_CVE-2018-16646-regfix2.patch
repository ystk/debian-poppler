From 08572e1bdca03baed694dd9828bb2b878865e669 Mon Sep 17 00:00:00 2001
From: Albert Astals Cid <aacid@kde.org>
Date: Sat, 3 Nov 2018 12:21:41 +0100
Subject: [PATCH] Parser::makeStream: Fix crash on malformed files

fixes oss-fuzz/11244
---
 poppler/Parser.cc | 4 ++++
 1 file changed, 4 insertions(+)

--- a/poppler/Parser.cc
+++ b/poppler/Parser.cc
@@ -232,6 +232,10 @@
     length = 0;
   }
 
+  // the above dictLookup can cause a xref reconstruction if the file is damaged
+  // so we need to update the entry pointer
+  entry = xref ? xref->getEntry(objNum, false) : NULL;
+
   // check for length in damaged file
   if (xref && xref->getStreamEnd(pos, &endPos)) {
     length = endPos - pos;
