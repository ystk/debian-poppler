From bf4aae25a244b1033a2479b9a8f633224f7d5de5 Mon Sep 17 00:00:00 2001
From: William Bader <williambader@hotmail.com>
Date: Wed, 11 Feb 2015 17:35:40 +0100
Subject: [PATCH] Off by one fix to the previous crash fix

---
 fofi/FoFiTrueType.cc | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/fofi/FoFiTrueType.cc b/fofi/FoFiTrueType.cc
index 6ab8f9b7..11699dd6 100644
--- a/fofi/FoFiTrueType.cc
+++ b/fofi/FoFiTrueType.cc
@@ -1222,15 +1223,15 @@ void FoFiTrueType::cvtSfnts(FoFiOutputFunc outputFunc,
 	  dumpString(file + tables[j].offset, tables[j].len,
 		     outputFunc, outputStream);
 	} else if (needVerticalMetrics && i == t42VheaTable) {
-	  if (unlikely(length >= (int)sizeof(vheaTab))) {
+	  if (unlikely(length > (int)sizeof(vheaTab))) {
 	    error(errSyntaxWarning, -1, "length bigger than vheaTab size");
-	    length = sizeof(vheaTab) - 1;
+	    length = sizeof(vheaTab);
 	  }
 	  dumpString(vheaTab, length, outputFunc, outputStream);
 	} else if (needVerticalMetrics && i == t42VmtxTable) {
-	  if (unlikely(length >= vmtxTabLength)) {
+	  if (unlikely(length > vmtxTabLength)) {
 	    error(errSyntaxWarning, -1, "length bigger than vmtxTab size");
-	    length = vmtxTabLength - 1;
+	    length = vmtxTabLength;
 	  }
 	  dumpString(vmtxTab, length, outputFunc, outputStream);
 	}
-- 
2.20.1

